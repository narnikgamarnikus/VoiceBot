2011-09-26T07:17:00.000Z	tnud		Hi, I'm having problems running a bash script (running a jar) under cron, it starts fine but gets an exception during the process. I've activated the root account and added it to its crontab. Still same issue :/ Is there some variables I can set so it uses the same java and dirs as another user?
2011-09-26T07:18:00.000Z	tnud		This does not happen when I run it as the user or as root regularly
2011-09-26T07:18:00.000Z	codehotter	tnud	What is the exception?
2011-09-26T07:19:00.000Z	tnud	codehotter	Exception in thread "main" java.lang.UnsatisfiedLinkError: /root/.tectonicus/native/liblwjgl.so: /usr/lib/jvm/java-6-sun-1.6.0.26/jre/lib/amd64/libjawt.so: symbol awt_FreeDrawingSurface, version SUNWprivate_1.1 not defined in file libmawt.so with link time reference
2011-09-26T07:19:00.000Z	codehotter	tnud	I recommend that you do not run applications as root
2011-09-26T07:20:00.000Z	codehotter	tnud	can you paste the exception from your non-root user please?
2011-09-26T07:23:00.000Z	tnud	codehotter	Exception in thread "main" java.lang.UnsatisfiedLinkError: /home/dell/.tectonicus/native/liblwjgl.so: /usr/lib/jvm/java-6-sun-1.6.0.26/jre/lib/amd64/libjawt.so: symbol awt_FreeDrawingSurface, version SUNWprivate_1.1 not defined in file libmawt.so with link time reference
2011-09-26T07:25:00.000Z	codehotter	tnud	You've confirmed you're running the same command in cron as in your terminal? Can you pastebin your environment?
2011-09-26T07:26:00.000Z	tnud	codehotter	/etc/environment?
2011-09-26T07:26:00.000Z	codehotter	tnud	sorry, can you pastebin the output of 'env' from your terminal and cron?
2011-09-26T07:34:00.000Z	tnud	codehotter	http://pastebin.com/DjYqjLH2  wow..
2011-09-26T07:34:00.000Z	tnud	codehotter	one is quite a bit smaller then the first :P
2011-09-26T07:34:00.000Z	tnud	codehotter	or maybe I just failed the pipe?  env > /home/dell/env.txt ?
2011-09-26T07:45:00.000Z	codehotter	tnud	OK, so that means the environment is the problem.
2011-09-26T07:36:00.000Z	codehotter	tnud	I think the pipe worked OK
2011-09-26T07:40:00.000Z	tnud	codehotter	Tricky? :P
2011-09-26T07:41:00.000Z	codehotter	tnud	can you try from your normal terminal: env -i $(cat /tmp/crontabenv) <your script> ?
2011-09-26T07:42:00.000Z	codehotter	tnud	the point is to try the same environment crontab has in your normal terminal, to isolate the issue to environment. The file /tmp/crontabenv contains the env output from env as run under crontab.
2011-09-26T07:43:00.000Z	tnud	codehotter	/tmp/crontabenv does not exsist
2011-09-26T07:43:00.000Z	codehotter	tnud	yes, please create it ; )
2011-09-26T07:45:00.000Z	tnud	codehotter	I get the error.
2011-09-26T07:46:00.000Z	tnud	codehotter	Now how do I get crontab to work with dell or root environment.. Is there an alternative program that doesn't ahve this problem?
2011-09-26T07:46:00.000Z	codehotter	tnud	please don't consider running as root
2011-09-26T07:47:00.000Z	codehotter	tnud	it's irresponsible
2011-09-26T07:47:00.000Z	codehotter	tnud	Do you get the error if you run (in your normal terminal, in the directory /home/dell ?
2011-09-26T07:47:00.000Z	tnud	codehotter	Sorry haha
2011-09-26T07:48:00.000Z	tnud	codehotter	No
2011-09-26T07:48:00.000Z	tnud	codehotter	cd /home/dell and then ./path/to/script works
2011-09-26T07:49:00.000Z	codehotter	tnud	OK, I notice PATH is different, that may be relevant. Can you try setting PATH at the top of your script?
2011-09-26T07:49:00.000Z	tnud	codehotter	How do I do that and what should it contain :O
2011-09-26T07:52:00.000Z	tnud	codehotter	Nope, still same error
2011-09-26T07:53:00.000Z	codehotter	tnud	OK. You want the script to work under crontab, but you probably don't want to just copy your whole environment over. Are you familiar with binary search?
2011-09-26T07:54:00.000Z	codehotter	tnud	near the top of your script, put ". /tmp/environment" - this will cause it to run /tmp/environment. Then, first, put the output from your normal terminal in /tmp/environment, run your script, and see if you get the error
2011-09-26T07:56:00.000Z	tnud	codehotter	so force the script to load the whole environment then?
2011-09-26T07:56:00.000Z	codehotter	tnud	step 2: take out the bottom half of the environment and see if it still works
2011-09-26T07:57:00.000Z	codehotter	tnud	if it still works, take out the bottom half of the top half, and see if it still works. Etc. Until you have the minimum you need to get it to work
2011-09-26T07:57:00.000Z	tnud	codehotter	ahahaha, good idea :P
2011-09-26T07:57:00.000Z	codehotter	tnud	make sure you run the script with env -i /path/to/script
2011-09-26T07:58:00.000Z	tnud	codehotter	wait.. so env -i $(cat /home/dell/normalEnv.txt) /path/to/script ?
2011-09-26T08:03:00.000Z	tnud	codehotter	HMM, still failing.. In crontab: 2 6 * * * env -i /path/to/script  | in script . /home/dell/normalEnv  ?
2011-09-26T08:03:00.000Z	codehotter	tnud	try without crontab, just from your normal terminal
2011-09-26T08:04:00.000Z	tnud	codehotter	Getting a lot of command not found
2011-09-26T08:05:00.000Z	tnud	codehotter	looks like the LS_COLORS bit
2011-09-26T08:06:00.000Z	codehotter	tnud	OK, what if you put quotes around every line?
2011-09-26T08:07:00.000Z	codehotter	tnud	sed -ie "s/\(.*\)/\"\1\"/" /home/dell/normalEnv.txt
2011-09-26T08:10:00.000Z	tnud	codehotter	Well it worked if I just quoted the lines that were affected (like so XXX="asdkl asdklasd asdlkmas"). Still the same error though, Your thing just qouted the entire lines which didn't do much for the command not found
2011-09-26T08:11:00.000Z	tnud	codehotter	can't find any of them now :P
2011-09-26T08:11:00.000Z	codehotter	tnud	oh, my bad^^
2011-09-26T08:11:00.000Z	codehotter	tnud	I should test this before I tell you to try it
2011-09-26T08:11:00.000Z	tnud	codehotter	Maybe it's not the environment after all :/
2011-09-26T08:11:00.000Z	tnud	codehotter	haha, no worries :P
2011-09-26T08:12:00.000Z	tnud	codehotter	There is a related java problem with this specific file. It's already tricky to get it working in normal terminal. But now I do.. I just want it run at a regular basis :/
2011-09-26T08:12:00.000Z	tnud	codehotter	su dell
2011-09-26T08:13:00.000Z	tnud	codehotter	"normal" right? :P
2011-09-26T08:13:00.000Z	tnud	codehotter	if I remove the . /path to env yes
2011-09-26T08:19:00.000Z	tnud	codehotter	It is not.
2011-09-26T08:19:00.000Z	codehotter	tnud	 how is it different?
2011-09-26T08:20:00.000Z	tnud	codehotter	. /home/dell/normalEnv (newline in script) env > /home/dell/anotherEnv should provide the normalEnv in anotherEnv right?
2011-09-26T08:20:00.000Z	tnud	codehotter	PWD=/home/dell/MinecraftServer/Tectonicus SHLVL=3 _=/usr/bin/env                 <- That's the whole thing
2011-09-26T08:21:00.000Z	codehotter	tnud	OK, then can you try prefixing every line in /home/dell/normalEnv with "export "
2011-09-26T08:21:00.000Z	codehotter	tnud	sed -ie "s/$/export /" /home/dell/normalEnv
2011-09-26T08:21:00.000Z	codehotter	tnud	again, didn't test
2011-09-26T08:21:00.000Z	codehotter	tnud	should probably be ^ instead of $ there
2011-09-26T08:23:00.000Z	tnud	codehotter	omg....
2011-09-26T08:23:00.000Z	tnud	codehotter	Yes it was ^instead of $... It's WORKING
2011-09-26T08:23:00.000Z	codehotter	tnud	huh, what?
2011-09-26T08:24:00.000Z	tnud	codehotter	Thanks! HA! So relived xD
2011-09-26T08:24:00.000Z	codehotter	tnud	OK, now time to search ; ) or you can be lazy and copy the whole env
2011-09-26T08:25:00.000Z	tnud	codehotter	One more thing while I got you here, this script wants to copy files to /var/www and access some files from there too, which it can't under dell. How do I sudo the script under cron // make /var/www avalible to all users :O
2011-09-26T08:27:00.000Z	codehotter	tnud	I'm curious what environment variables were really needed?
2011-09-26T08:30:00.000Z	tnud	codehotter	I'm working on it :P Meanwhile.. howto make dell have access to /var/www // run cron job as sudo :O
2011-09-26T08:30:00.000Z	codehotter	tnud	The question is, why does dell need access to /var/www ?
2011-09-26T08:31:00.000Z	tnud	codehotter	The jar is generating a map which I need avalible from the web
2011-09-26T08:31:00.000Z	codehotter	tnud	OK. What else does your script need to modify?
2011-09-26T08:32:00.000Z	tnud	codehotter	Just that, it saves image files to a folder under /var/www and has a cache there too (so it doesn't waste time on stuff that hasn't changed since last time
2011-09-26T08:33:00.000Z	codehotter	tnud	OK. Are you using the user 'dell' just for running the script or for other things too?
2011-09-26T08:33:00.000Z	tnud	codehotter	It's the only user I have except the root acc
2011-09-26T08:33:00.000Z	tnud	codehotter	Which I intend to disable again after this is figured out :P
2011-09-26T08:35:00.000Z	codehotter	tnud	OK. Create a new user with 'useradd <name>' then give the new user write access to the subdirectory in /var/www (and set up the script for the new user)
2011-09-26T08:35:00.000Z	tnud	codehotter	How do I give a user read/write access to a folder (and subfolders) ? :/
2011-09-26T08:36:00.000Z	codehotter	tnud	the easiest way is to just chown it to them.
2011-09-26T08:36:00.000Z	codehotter	tnud	chown <user> <folder>
2011-09-26T08:36:00.000Z	tnud	codehotter	I'm down to 5 lines of env btw
2011-09-26T08:36:00.000Z	codehotter	tnud	good news
2011-09-26T08:38:00.000Z	tnud	codehotter	DISPLAY=:0
2011-09-26T08:39:00.000Z	codehotter	tnud	whoa, I definitely didn't expect that. The java thing shows a GUI?
2011-09-26T08:39:00.000Z	tnud	codehotter	It shouldn't
2011-09-26T08:39:00.000Z	tnud	codehotter	I've set it to no gui mode, hmm
2011-09-26T08:39:00.000Z	tnud	codehotter	oh well, it works! Thanks for all the help!
2011-09-26T08:40:00.000Z	codehotter	tnud	maybe the code is poorly written, and checks to see if there's an X environment before checking to see if it is run in GUI mode or not
2011-09-26T08:40:00.000Z	codehotter	tnud	no problem. You got your /var/www thing sorted too?
2011-09-26T08:43:00.000Z	tnud	codehotter	I just discovered -R with --help :P
2011-09-26T08:43:00.000Z	tnud	codehotter	Yes it's working! :D
2011-09-26T08:49:00.000Z	codehotter	tnud	final thing, you may have figured ito ut already. It's no sense to keep the export DISPLAY=0 in a separate file when it's only one line, best to put it in your main script with a comment why it's necessary and just remove the ". /path/to/newEnv.txt"
