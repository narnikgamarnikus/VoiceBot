2011-05-01T00:23:00.000Z	MrMist1		I'm desperate.. Need to sort out how to set a "spin down" parameter with hdparm.. I can't do it in Natty..
2011-05-01T00:25:00.000Z	ohsix	MrMist1	it's still done with /etc/hdparm.conf
2011-05-01T00:25:00.000Z	MrMist1	ohsix	It doesn't seem to be read during boot.. My hd doesn't spin down
2011-05-01T00:26:00.000Z	ohsix	MrMist1	oh it's definitely read, every time there is a power event; your settings probably don't allow the drive to spin down
2011-05-01T00:26:00.000Z	ohsix	MrMist1	post the output of sudo hdparm -I /dev/sda to a pastebin
2011-05-01T00:26:00.000Z	MrMist1	ohsix	Sure does... If I use hdparm -S 4, it spins down in 20 seconds time
2011-05-01T00:27:00.000Z	ohsix	MrMist1	there are two other power settings that keep the drive awake, setting the sleep time isn't always going to do it by itself
2011-05-01T00:28:00.000Z	MrMist1	ohsix	So hdparm -S 5 isn't the same as spindown_time = 5?
2011-05-01T00:28:00.000Z	MrMist1	ohsix	I thought they were supposed to be equivalent
2011-05-01T00:34:00.000Z	MrMist1	ohsix	http://paste.ubuntu.com/601444/
2011-05-01T00:36:00.000Z	ohsix	MrMist1	the apm settings can affect how a drive chooses to spin down, the hdparm manual (man hdparm in a terminal) explains in what way
2011-05-01T00:39:00.000Z	MrMist1	ohsix	Any idea? I seriously don't think this is the drive, since the -S parameter works fine..
2011-05-01T00:50:00.000Z	MrMist1	ohsix	man hdparm doesn't say anything about apm. Do you mean that hdparm.conf demands other set values of the disks APM-parameter than the hdparm -y/hdparm -S commands?
2011-05-01T00:51:00.000Z	ohsix	MrMist1	press /-B and hit enter in the manual viewer; it will take you right to it
2011-05-01T00:57:00.000Z	MrMist1	ohsix	Well... interesting thing this. I'm trying to set the APM value by using hdparm.conf, but the hdparm -I command still returns 254
2011-05-01T00:58:00.000Z	ohsix	MrMist1	seagate drives can be pretty weird
2011-05-01T00:58:00.000Z	MrMist1	ohsix	It worked on 10.04
2011-05-01T00:58:00.000Z	ohsix	MrMist1	you need to set your options with hdparm initially, if you want to check immediately if they take effect
2011-05-01T00:59:00.000Z	ohsix	MrMist1	to test my hdparm.conf changes i just unplugged and replugged in my power cord on my laptop, that isn't practical for everyone and you can still run the power script manually to apply them immediately
2011-05-01T00:59:00.000Z	ohsix	MrMist1	but best practice, set manually with hdparm, then migrate your settings to be applied to hdparm.conf; and to note that hdparm.conf has settings for when it's on battery and when it isn't
2011-05-01T01:01:00.000Z	MrMist1	ohsix	Hey.. I'm not doing anything more than "hdparm -S 32". And voila, it works. Then I set hdparm.conf to /dev/sdd { spindown_time = 32 }, and it's not working
2011-05-01T01:02:00.000Z	ohsix	MrMist1	i dont' know what to say, i'm using 11.04 and it works here, let me triple check right now
2011-05-01T01:03:00.000Z	ohsix	MrMist1	they are being applied here
2011-05-01T01:03:00.000Z	MrMist1	ohsix	How can you see? By hdparm -I ?
2011-05-01T01:04:00.000Z	ohsix	MrMist1	yep, hdparm -I
2011-05-01T01:04:00.000Z	MrMist1	ohsix	Hmm... strange
2011-05-01T01:05:00.000Z	MrMist1	ohsix	Is there any way to detect that the script is actually being run during boot?
2011-05-01T01:06:00.000Z	ohsix	MrMist1	well it's run during power events, which as far as i know is at least once during boot
2011-05-01T01:08:00.000Z	MrMist1	ohsix	I'm running a "ubuntu-server" machine... don't know it that matters. I've also got the disks mounted via fstab... but I still want them to spin down
2011-05-01T01:09:00.000Z	ohsix	MrMist1	oh, i dont think it does, but acpi power events might not run on the server version, i do not know
2011-05-01T01:14:00.000Z	MrMist1	ohsix	rgr: Simple, really. I've got three drives. One for the OS.  The second drive contains home folders (samba shared). They're being used maybe once or twice a day. To have the disk spinning all the time is a waste of energy, and it's noisy. The third drive is the backup drive. I'm going to script it to copy drive 2 once every night. It's never being used for anything else. Hence, two of the drives should be spun down.
2011-05-01T01:15:00.000Z	ohsix	MrMist1	you need not give me any justification, and wasn't your problem that it wasn't being applied?
2011-05-01T01:16:00.000Z	MrMist1	ohsix	Yeah, it was meant for the other guy. I just wanted to tell you as well :) He wondered why I needed to spin them down :)
2011-05-01T01:17:00.000Z	ohsix	MrMist1	well, unless you want to waste your time, let him wonder; let me poke around a bit
2011-05-01T01:17:00.000Z	ohsix	MrMist1	ok didn't have to look much! udev applies hdparm settings when drives show up, so it should apply at boot
2011-05-01T01:18:00.000Z	ohsix	MrMist1	barring udev not working, or you not using an intitramfs or some other odd special situation you've created for yourself, it should work
2011-05-01T01:18:00.000Z	MrMist1	ohsix	I've changed the script /lib/udev/hdparam now... touching a file when it's run. Trying to boot to check if the file is being created
2011-05-01T01:18:00.000Z	ohsix	MrMist1	don't change those files, they will be overwritten on an update
2011-05-01T01:19:00.000Z	ohsix	MrMist1	er nm that's probably ok
2011-05-01T01:19:00.000Z	ohsix	MrMist1	you can just ask udev to be noisy about what it's doing, and do it without a reboot even
2011-05-01T01:19:00.000Z	MrMist1	ohsix	It's ok.. it's just for debugging purposes. Hehe
2011-05-01T01:19:00.000Z	ohsix	MrMist1	sec i'll whip up something to run
2011-05-01T01:20:00.000Z	MrMist1	ohsix	Thanks. I'm booting now to see if the script creates the file
2011-05-01T01:20:00.000Z	ohsix	MrMist1	udevadm test /sys/block/sdd it will run udev and tell you everything it does, here it says at the end: udevadm_test: run: '/lib/udev/hdparm'
2011-05-01T01:22:00.000Z	MrMist1	ohsix	The hdparm.called was NOT created during boot. Which again means that /lib/udev/hdparm is not being called
2011-05-01T01:23:00.000Z	MrMist1	ohsix	Ehm.. but I'm just booting using "sudo reboot", not a physical on/off. Should I try that?
2011-05-01T01:25:00.000Z	MrMist1	ohsix	Strange... tried your test, and it still says it's trying running the file, but no "hdparm.called" file is being created
2011-05-01T01:26:00.000Z	ohsix	MrMist1	well test doesn't actually run it, it just says what is done when the device name shows up, ie. what's done at boot
2011-05-01T01:27:00.000Z	ohsix	MrMist1	let me look some more, i don't know of any circumstances where it might be disabled, but it very well may be for some reason on server
2011-05-01T01:29:00.000Z	MrMist1	ohsix	I called "head /lib/udev/hdparm" - http://paste.ubuntu.com/601453/
2011-05-01T01:34:00.000Z	MrMist1	ohsix	Couldn't I just create a .sh file calling "hdparm -S 120 /dev/sdd ?
2011-05-01T01:37:00.000Z	ohsix	MrMist1	you could but it wouldn't fix whatever problem is stopping it from working as it is now
2011-05-01T01:37:00.000Z	MrMist1	ohsix	Hehe... I know. But where would I place such a script?
2011-05-01T01:38:00.000Z	ohsix	MrMist1	rc.local, drives get reset at runtime and stuff so it might not stick forever past boot
2011-05-01T01:38:00.000Z	MrMist1	ohsix	Should I create a bug report or something about this issue?
2011-05-01T01:38:00.000Z	ohsix	MrMist1	yea, bonus if you can find the cause, searching to see if there is one already would probably be good
2011-05-01T01:39:00.000Z	MrMist1	ohsix	I don't know if I know enough about udev to be able to find where the fault is ?
2011-05-01T01:43:00.000Z	ohsix	MrMist1	if udevadm test says it's running the helper then it's not udev
2011-05-01T01:43:00.000Z	MrMist1	ohsix	but it's not being run..
2011-05-01T01:44:00.000Z	ohsix	MrMist1	right, looking into that now; had to get something to eath
2011-05-01T01:45:00.000Z	ohsix	MrMist1	if you do "DEVNAME=/dev/sdd /lib/udev/hdparm" does it apply your settings to sdd?
2011-05-01T01:45:00.000Z	MrMist1	ohsix	I'm really grateful for the help, but I don't want to keep you from eating
2011-05-01T01:46:00.000Z	ohsix	MrMist1	already ate, forgot i was helping someone :o
2011-05-01T01:47:00.000Z	MrMist1	ohsix	Hmm... interesting. When I call "sudo DEVNAME=/dev/sdd /lib/udev/hdparm" I get "No disk enabled. Exiting"
2011-05-01T01:47:00.000Z	ohsix	MrMist1	eh ok, with sudo you need to do sudo sh -c 'DEVNAME=/dev/sda /lib/udev/hdparm'
2011-05-01T01:48:00.000Z	MrMist1	ohsix	I tried doing a "sudo sh -" first as well, and calling it without sudo... same result
2011-05-01T01:48:00.000Z	MrMist1	ohsix	eeeh... "sudo su -" not "sudo sh -"
2011-05-01T01:48:00.000Z	ohsix	MrMist1	sudo -- sh -c 'DEVNAME=/dev/sda /lib/udev/hdparm' agh ;]
2011-05-01T01:50:00.000Z	MrMist1	ohsix	Identical results, all of them
2011-05-01T01:50:00.000Z	MrMist1	ohsix	"No disk enabled. Exiting"
2011-05-01T01:50:00.000Z	ohsix	MrMist1	paste your hdparm.conf to a pastebin
2011-05-01T01:50:00.000Z	MrMist1	ohsix	It's nothing in it almost
2011-05-01T01:51:00.000Z	MrMist1	ohsix	hmm... I've got an idea..
2011-05-01T01:52:00.000Z	MrMist1	ohsix	http://paste.ubuntu.com/601466/
2011-05-01T01:53:00.000Z	ohsix	MrMist1	you have a stray } :O
2011-05-01T01:54:00.000Z	MrMist1	ohsix	argh... still same result after commenting out the line
2011-05-01T01:55:00.000Z	ohsix	MrMist1	you need to read the spindown time with a command other than hdparm -I, -I was just to check to see if aam/apm was on, which can impact drives spinning down
2011-05-01T01:55:00.000Z	ohsix	MrMist1	sorry if i wasn't explicit before, i thought you added apm settings to allow spindowns
2011-05-01T01:55:00.000Z	MrMist1	ohsix	I did, but since the file isn't being called anyway
2011-05-01T01:55:00.000Z	MrMist1	ohsix	I removed them again. Less is more
2011-05-01T01:56:00.000Z	MrMist1	ohsix	I had "apm = 127" before, but it did nothing.
2011-05-01T01:56:00.000Z	ohsix	MrMist1	try the DEVNAME thing again with the stray } removed
2011-05-01T01:57:00.000Z	MrMist1	ohsix	aaah... there's a stray }?? Didn't see that one..
2011-05-01T01:58:00.000Z	MrMist1	ohsix	Now we're talking.. it's being run now...
2011-05-01T02:04:00.000Z	MrMist1	ohsix	Seems like it's working now for the two drives I have mountet, but the backup-drive which I'm not mounting won't go into standby mode. Any idea why? Can I place it in standby mode during boot?
2011-05-01T02:16:00.000Z	MrMist1	ohsix	Hmm... Can't get sdd into sleep mode, but the two other drives works perfectly. Is it because I don't mount it somehow? I don't need to have it mounted..
2011-05-01T02:18:00.000Z	ohsix	MrMist1	you shouldn't need it mounted,  but your firmware might ignore what you tell it, or it might be entangled with the other power/noise settings like i said earlier
2011-05-01T02:24:00.000Z	MrMist1	ohsix	Hehe... by mounting the drive through fstab, it now goes into sleep mode. I'm not setting any APM parameter at all in any config. Thanks for all the help by the way
2011-05-01T02:24:00.000Z	ohsix	MrMist1	hm interesting
2011-05-01T02:25:00.000Z	ohsix	MrMist1	there were some changes about delayed settings applications with libata way back when, it probably doesn't even try and talk to the drive until it's in use for something
2011-05-01T02:25:00.000Z	ohsix	MrMist1	if you want your sleep settings to be applied be sure to run whatever you need to with hdparm to tell the drive to save the settings over resets; it still might not do it, but it's the best you can do given the circumstances
2011-05-01T02:57:00.000Z	MrMist1	ohsix	I'm using hdparam.conf just like before. No changes except the brace
2011-05-01T02:57:00.000Z	MrMist1	ohsix	Gotta go... thanks for all the help though :)
